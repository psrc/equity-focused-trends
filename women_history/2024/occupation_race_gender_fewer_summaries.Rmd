---
title: "occupation_race_gender"
author: "suzanne"
date: "2024-02-09"
output: html_document
---
https://www.wsj.com/economy/jobs/workers-america-jobs-demographics-charts-94a5ff6c?st=suj8l825gtmpp0s&reflink=article_copyURL_share

https://www.americanprogress.org/article/occupational-segregation-in-america/#interactive-visualization


```{r setup, include=FALSE}
library(psrccensus)
library(tidycensus)
library(dplyr)
library(tidyr)
library(psrcplot)
library(tidyverse)

```

data dictionary
```{r}
pums_vars<-tidycensus::pums_variables%>%filter(survey=='acs5')%>%filter(year==2022)

```

```{r}
acs_vars<-tidycensus::load_variables(2022, 'acs1', cache=TRUE)
```

## Median Wage by Race and Sex, workers more than 30 hours per week
```{r}
race_sex_wage<-get_psrc_pums(span =5, dyear= 2022, level='p', vars= c("SEX", "PRACE", "WAGP", 'ESR', 'WKHP'))%>%filter(WKHP>30)

```
```{r}

race_sex_wage_wrkr<-race_sex_wage%>%mutate(worker=case_when(str_detect(ESR, 'Armed') ~'Worker',
                                                            str_detect(ESR, 'Civilian')~'Worker',
                                                            .default = 'Not Worker'))
```

```{r}
race_sex_medwage<-psrc_pums_median(race_sex_wage_wrkr, stat_var='WAGP', group_vars=c('SEX', 'PRACE','worker'))
```

Overall median wage for all workers who work more than 30 hours per week
```{r}
med_wage<-psrc_pums_median(race_sex_wage_wrkr, stat_var='WAGP', group_vars=c('worker'))
```

```{r}
med_wage_wrker<-med_wage%>%filter(worker=='Worker')%>%pull(WAGP_median)


```



```{r}
race_sex_medwage_wrkr<-race_sex_medwage%>%filter(worker=='Worker')%>%filter(worker!='Total')%>%filter(PRACE!='Total') %>%filter(SEX != 'Total')%>%mutate(median_wage_rd=round(WAGP_median,-3))
race_sex_medwage_wrkr<-race_sex_medwage_wrkr%>%mutate(PRACE_ordered=forcats::fct_reorder(PRACE, -median_wage_rd))
psrcplot::static_bar_chart(t=race_sex_medwage_wrkr, y='PRACE', x='median_wage_rd', fill='SEX', est='currency', moe='WAGP_median_moe')+
                          ggplot2::geom_hline(yintercept= med_wage_wrker, 
                                              linetype='dotdash', 
                                              linewidth=1, 
                                              show.legend = FALSE, 
                                              color='#00716c') +
                          ggplot2::annotate("text", 
                                            y=med_wage_wrker+5000, 
                                            x=6, 
                                            label="Region",
                                            angle='270', 
                                            color='#00716c')
```



## Top Occupation by Race and Sex

```{r}
soc_gend_prace<-get_psrc_pums(span =5, dyear= 2022, level='p', vars= c("SOCP", "SEX", "PRACE"))
```

```{r}
esr_prace<-get_psrc_pums(span =5, dyear= 2022, level='p', vars= c("ESR", "PRACE"))
esr_prace_count<-psrc_pums_count(esr_prace, group_vars=c("ESR", 'PRACE'))

```


count how many by sex, race and occupation
```{r}
soc_gend_count_prace<-psrc_pums_count(soc_gend_prace, group_vars=c("SOCP", "SEX", 'PRACE'))

```
Top Occupation by Race and Gender (detailed)

```{r }
job_grp_gender_race<-soc_gend_count_prace%>%
  group_by(SOCP, SEX, PRACE)%>%
  summarize(workers=sum(count))%>%
  filter(SEX!='Total')%>%filter(PRACE!='Total')%>%filter(SOCP!='Total')%>%
  group_by(SEX, PRACE)%>%filter(workers==max(workers))%>%arrange(SOCP,SEX, PRACE)%>%
  pivot_wider(id_cols=PRACE, names_from=SEX, values_from=SOCP)
```

```{r}
write.csv(job_grp_gender_race, 'soc_gend_racecount.csv')
```



Median Earnings by Occupation, To find the top and bottom occupations
```{r}
earnings_by_occ<-get_psrc_pums(span =5, dyear= 2022, level='p', vars= c("SOCP", "WAGP"))
```
only taking good reliability estimates
```{r}
earn_by_occ_median<-psrc_pums_median(earnings_by_occ, stat_var="WAGP",group_vars= c('SOCP'),rr=TRUE)%>%filter(COUNTY=='Region' & reliability=='good')
```
## Top Ten Occupations by Median Wages
```{r}
top_10<-earn_by_occ_median%>%top_n(n=10, wt=WAGP_median)%>%mutate(occupation=forcats::fct_reorder(substr(SOCP,5,25), -WAGP_median))%>%mutate(MedianWage=round(WAGP_median, -3))

```

workers by race in the top ten occupations was difficult to analyze (so many categories) Also Asian and white workers accounted for such a great share of the top professions, it was hard to see the other race categories; we could potentially summarize all other races?

# Find the share of workers by sex in the top ten occupations

```{r}
soc_sex<-get_psrc_pums(span =5, dyear= 2022, level='p', vars= c("SOCP", "SEX"))

```

```{r}
soc_sex_count<-psrc_pums_count(soc_sex, group_vars=c("SOCP",  'SEX'))%>%filter(COUNTY=='Region')
```

```{r}
share_occ_sex<-merge(soc_sex_count, top_10)%>%filter(SEX!='Total')%>%mutate(occupation=forcats::fct_reorder(substr(SOCP,5,25), -WAGP_median))
```
```{r}

static_bar_chart(top_10, y='occupation', x='MedianWage', fill='COUNTY', est='currency' )
```

Share of all Workers that is Female

```{r}
esr_sex<-get_psrc_pums(span =5, dyear= 2022, level='p', vars= c("SEX",  'ESR'))
```

```{r}
worker_sex<- esr_sex%>%mutate(worker=case_when(str_detect(ESR, 'Armed') ~'Worker',
                                                            str_detect(ESR, 'Civilian')~'Worker',
                                                            .default = 'Not Worker'))
```


```{r}
share_wrkr_sex<- psrc_pums_count(worker_sex, group_vars=c( 'worker','SEX'))%>%filter(worker=='Worker' & SEX=='Female')%>%pull(share)
```

```{r}
static_bar_chart(t=share_occ_sex, y= 'occupation', x='share', fill= 'SEX', pos='stack')+
                          ggplot2::geom_hline(yintercept= share_wrkr_sex, 
                                              linetype='dotdash', 
                                              linewidth=1, 
                                              show.legend = FALSE, 
                                              color='#00716c') +
                          ggplot2::annotate("text", 
                                            y=share_wrkr_sex, 
                                            x=6, 
                                            label="Female Share of all Workers",
                                            angle='270', 
                                            color='#00716c')
```

Bottom Ten Occupations

```{r}
bottom_10<-earn_by_occ_median%>%top_n(n=-10, wt=WAGP_median)%>%mutate(occupation=forcats::fct_reorder(substr(SOCP,5,25), -WAGP_median))%>%mutate(MedianWage=round(WAGP_median, -3))

```


# Find the share of workers by sex in the bottom ten occupations

`

```{r}
share_occ_sex<-merge(soc_sex_count, bottom_10)%>%filter(SEX!='Total')%>%mutate(occupation=forcats::fct_reorder(substr(SOCP,5,25), -WAGP_median))
```

```{r}

static_bar_chart(bottom_10, y='occupation', x='MedianWage', fill='COUNTY', est='currency' )
```

```{r}
static_bar_chart(t=share_occ_sex, y= 'occupation', x='share', fill= 'SEX', pos='stack')+
                          ggplot2::geom_hline(yintercept= share_wrkr_sex, 
                                              linetype='dotdash', 
                                              linewidth=1, 
                                              show.legend = FALSE, 
                                              color='#00716c') +
                          ggplot2::annotate("text", 
                                            y=share_wrkr_sex, 
                                            x=6, 
                                            label="Female Share of all Workers",
                                            angle='270', 
                                            color='#00716c')
```
